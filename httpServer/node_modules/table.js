var db= require("db");
var httpMsg=require("httpMsg")
var mysql= require("mysql");

exports.getCarList=function(req, resp){
    db.excuteSql("SELECT DISTINCT make FROM VehicleModelYear",function(data, err){
        if(err){
            httpMsg.show500(req,resp,err);
        }else{
            httpMsg.sendJson(req,resp,data);
        }
    })
};

exports.getUserList=function(req, resp){
    db.excuteSql("SELECT * FROM user",function(data, err){
        if(err){
            httpMsg.show500(req,resp,err);
        }else{
            httpMsg.sendJson(req,resp,data);
        }
    })
};

exports.addUser=function(req,resp,reqBody){
    try{
        if(!reqBody) throw new Error("Input not valid");
        var data=JSON.parse(reqBody);
        if(data){
            var sql="Insert INTO user(email,password) VALUES("+mysql.escape(data.email)+","+mysql.escape(data.password)+")";
            console.log(sql);
            db.excuteSql(sql,function(data,err){
                if(err){
                    httpMsg.show500(req,resp,err);
                }else{
                    httpMsg.send200(req,resp); 
                }
            });
        }
        else{
            throw new Error("Input not valid");
        }
    }
    catch(error){
        httpMsg.show500(req,resp,error);
    }
};

exports.updateUser=function(req,resp,reqBody){
    try{
        if(!reqBody) throw new Error("Input not valid");
        var data=JSON.parse(reqBody);
        if(data){  
            if(!data.email) throw new Error("Email not provided")
            var sql="UPDATE user SET password= ("+mysql.escape(data.password)+") WHERE email=("+mysql.escape(data.email)+")";
            console.log(sql);
            db.excuteSql(sql,function(data,err){
                if(err){
                    httpMsg.show500(req,resp,err);
                }else{
                    httpMsg.send200(req,resp); 
                }
            });
        }
        else{
            throw new Error("Input not valid");
        }
    }
    catch(error){
        httpMsg.show500(req,resp,error);
    }
};